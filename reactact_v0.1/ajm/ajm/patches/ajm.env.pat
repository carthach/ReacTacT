max v2;#N vpatcher 454 125 1012 708;#P window setfont "Sans Serif" 9.;#P window linecount 1;#P newex 306 264 45 196617 onebang;#P newex 446 81 66 196617 pvar sustain;#P comment 118 438 45 196617 sustain;#P toggle 166 435 15 0;#P objectname sustain;#P button 306 216 15 0;#P objectname trigger-release;#P comment 327 219 81 196617 trigger-release;#N comlet sends 1 when playing starts \, 0 when playing stops;#P outlet 317 536 15 0;#P comment 349 306 59 196617 release env;#N comlet release envelope (line format);#P inlet 321 42 15 0;#P comment 310 28 38 196617 release;#B color 14;#P newex 127 67 27 196617 t f f;#P newex 144 112 27 196617 + 1;#P newex 99 141 38 196617 gate 2;#P newex 144 90 39 196617 <= 0.;#N comlet sustain;#P inlet 446 50 15 0;#P comment 443 32 38 196617 sustain;#B color 5;#N comlet attack envelope (line format);#P inlet 249 42 15 0;#N comlet max amplitude. 0 stops playing.;#P inlet 127 43 15 0;#N comlet enveloped signal~;#P outlet 30 532 15 0;#P newex 30 474 29 196617 *~;#N comlet signal~;#P inlet 30 44 15 0;#P comment 139 147 40 196617 noteoff;#P newex 446 104 30 196617 t i i;#P newex 55 242 64 196617 pvar playing;#P newex 166 509 104 196617 pvar trigger-release;#P window linecount 3;#P comment 445 156 97 196617 if sustain is turned off when playing \, treat like a noteoff;#P window linecount 1;#P newex 466 127 32 196617 sel 0;#P newex 166 459 31 196617 == 0;#P comment 64 155 40 196617 noteon;#P window linecount 2;#P comment 284 415 40 196617 after release;#P window linecount 1;#P newex 306 311 29 196617 t l 2;#P newex 145 280 29 196617 t l 1;#P newex 238 403 38 196617 gate 2;#P newex 317 478 21 196617 t 0;#P newex 99 170 53 196617 t b 1 f b;#P newex 290 177 29 196617 gate;#P toggle 317 518 13 0;#P objectname playing;#P window linecount 6;#P comment 362 479 140 196617 noteoff: only if sustained and playing \, send release-env to line. when line ends: stop playing. an implicit noteoff is also sent when sustain is turned off while playing;#P window linecount 1;#P newex 306 288 132 196617 zl reg 0 500;#P newex 145 256 114 196617 zl reg 0 0 1 500 0 500;#P newex 166 485 47 196617 gate 1 1;#P newex 127 389 27 196617 *~;#P newex 225 342 32 196617 line~;#P window linecount 4;#P comment 362 413 140 196617 noteon: set max amp \, start playing \, send attack env to line. When line ends: if not sustain then send release-env;#P window linecount 1;#P comment 275 538 41 196617 Playing;#B color 10;#P comment 187 274 55 196617 attack env;#P window linecount 2;#P comment 199 414 39 196617 after attack;#P window linecount 1;#P comment 106 460 60 196617 not sustain;#P window linecount 3;#P comment 214 473 71 196617 if sustain is off and attack is done;#P window linecount 1;#P comment 126 27 57 196617 amplitude;#P comment 236 27 38 196617 attack;#B color 6;#P comment 22 29 39 196617 signal;#P window linecount 5;#P comment 364 339 141 196617 the amplitude value scales the envelope and triggers noteons and noteoffs. numbers > 0 are noteons \, numbers <= 0 are noteoffs.;#P window linecount 2;#P comment 57 379 73 196617 scale envelope by amplitude;#P comment 37 493 63 196617 scale signal by envelope;#P window linecount 3;#P comment 352 251 75 196617 only one noteoff allowed per noteon;#P connect 35 0 36 0;#P connect 36 0 37 0;#P connect 14 0 36 1;#P connect 21 1 32 0;#P lcolor 11;#P connect 44 0 43 0;#P connect 43 0 21 0;#P lcolor 7;#P connect 38 0 45 0;#P connect 45 0 43 1;#P connect 21 2 14 0;#P connect 45 1 42 0;#P connect 42 0 44 0;#P connect 13 0 14 1;#P fasten 21 0 16 0 104 203 150 203;#P lcolor 7;#P connect 16 0 24 0;#P lcolor 7;#P connect 52 0 28 0;#P lcolor 6;#P connect 28 0 15 0;#P lcolor 6;#P connect 15 0 31 0;#P lcolor 7;#P connect 23 0 15 1;#P lcolor 7;#P fasten 25 0 13 0 311 335 230 335;#P lcolor 15;#P fasten 24 0 13 0 150 326 230 326;#P lcolor 7;#P fasten 25 1 23 0 330 390 243 390;#P lcolor 15;#P connect 24 1 23 0;#P lcolor 7;#P connect 39 0 16 1;#P lcolor 7;#P connect 13 1 23 1;#P fasten 33 0 20 0 451 130 295 130;#P lcolor 6;#P connect 29 0 51 0;#P lcolor 15;#P connect 20 0 51 0;#P lcolor 15;#P connect 51 0 55 0;#P lcolor 15;#P connect 55 0 17 0;#P connect 17 0 25 0;#P lcolor 15;#P fasten 43 1 20 1 132 161 314 161;#P lcolor 15;#P connect 23 1 22 0;#P lcolor 15;#P connect 22 0 19 0;#P lcolor 11;#P connect 19 0 49 0;#P lcolor 11;#P fasten 21 3 55 1 146 192 227 192 271 235 271 253 346 253;#P lcolor 7;#P fasten 47 0 17 1 326 147 433 147;#P lcolor 15;#P connect 41 0 54 0;#P lcolor 6;#P connect 54 0 33 0;#P lcolor 6;#P connect 33 1 29 0;#P lcolor 6;#P pop;